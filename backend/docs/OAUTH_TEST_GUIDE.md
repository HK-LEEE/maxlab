# OAuth í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ê°œìš”

MAX Labì˜ OAuth 2.0 í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. 
ì™„ì „í•œ OAuth ì „ìš© ì¸ì¦ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì¸¡ë©´ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ë„êµ¬

### 1. ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ (Bash)
```bash
# í† í° ì—†ì´ ê¸°ë³¸ í…ŒìŠ¤íŠ¸
./tests/quick_oauth_test.sh

# OAuth í† í°ìœ¼ë¡œ ì „ì²´ í…ŒìŠ¤íŠ¸
./tests/quick_oauth_test.sh YOUR_OAUTH_TOKEN
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ (Python)
```bash
# í† í° ì—†ì´ ì‹¤í–‰
python tests/test_oauth_flow.py

# OAuth í† í°ìœ¼ë¡œ ì‹¤í–‰
python tests/test_oauth_flow.py --token YOUR_OAUTH_TOKEN
```

### 3. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```bash
# OAuth ê´€ë ¨ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pytest tests/unit/test_oauth_integration.py -v
```

## OAuth í† í° íšë“ ë°©ë²•

### ë°©ë²• 1: ë„ìš°ë¯¸ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
```bash
python tests/get_oauth_token.py
```
ìŠ¤í¬ë¦½íŠ¸ê°€ OAuth ë¡œê·¸ì¸ URLì„ ìƒì„±í•˜ê³  ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ì¤ë‹ˆë‹¤.

### ë°©ë²• 2: ìˆ˜ë™ìœ¼ë¡œ í† í° íšë“
1. ì¸ì¦ ì„œë²„ (http://localhost:8000) ì ‘ì†
2. OAuth ë¡œê·¸ì¸ ìˆ˜í–‰
3. ë¦¬ë‹¤ì´ë ‰íŠ¸ URLì—ì„œ access_token ì¶”ì¶œ

### ë°©ë²• 3: cURLì„ í†µí•œ ì§ì ‘ ìš”ì²­ (ê°œë°œ í™˜ê²½)
```bash
# ì‚¬ìš©ì ë¡œê·¸ì¸ (ì„¸ì…˜ ê¸°ë°˜)
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "your-username", "password": "your-password"}'
```

## í…ŒìŠ¤íŠ¸ í•­ëª©

### 1. ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸
- âœ… í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
- âœ… ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ ì°¨ë‹¨

### 2. OAuth ì¸ì¦ í”Œë¡œìš°
- âœ… Bearer í† í° ê²€ì¦
- âœ… í† í° ë§Œë£Œ ì²˜ë¦¬
- âœ… ì˜ëª»ëœ í† í° ê±°ë¶€

### 3. ì‚¬ìš©ì/ê·¸ë£¹ ë§¤í•‘
- âœ… OAuth IDë¥¼ í†µí•œ ì‚¬ìš©ì ì¡°íšŒ
- âœ… ì‚¬ìš©ì UUID ë§¤í•‘
- âœ… ê·¸ë£¹ ì •ë³´ ë™ê¸°í™”

### 4. ê¶Œí•œ ê´€ë¦¬
- âœ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì ‘ê·¼ ê¶Œí•œ
- âœ… ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
- âœ… ê·¸ë£¹ ê¸°ë°˜ ê¶Œí•œ

### 5. ì˜¤ë¥˜ ì²˜ë¦¬
- âœ… êµ¬ì¡°í™”ëœ ì˜¤ë¥˜ ì‘ë‹µ
- âœ… ë‹¤êµ­ì–´ ì˜¤ë¥˜ ë©”ì‹œì§€
- âœ… ì˜¤ë¥˜ ì½”ë“œ ì²´ê³„

### 6. ì„±ëŠ¥
- âœ… 200ms ì´ë‚´ ì‘ë‹µ ì‹œê°„
- âœ… ìºì‹± íš¨ê³¼
- âœ… Redis ì—†ì´ë„ ë™ì‘

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì™„ì „í•œ OAuth í”Œë¡œìš°
```bash
# 1. OAuth í† í° íšë“
python tests/get_oauth_token.py

# 2. í† í°ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
./tests/quick_oauth_test.sh eyJhbGciOiJIUzI1NiIs...

# 3. ê²°ê³¼ í™•ì¸
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì˜¤ë¥˜ ì²˜ë¦¬ ê²€ì¦
```bash
# 1. ì˜ëª»ëœ í† í°ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
./tests/quick_oauth_test.sh invalid_token_12345

# 2. ë§Œë£Œëœ í† í°ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
./tests/quick_oauth_test.sh expired_token_here
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```bash
# Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ì„±ëŠ¥ ì¸¡ì •
python tests/test_oauth_flow.py --token YOUR_TOKEN
```

## ì˜ˆìƒ ê²°ê³¼

### ì„±ê³µì ì¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼
```
======================================
ğŸš€ MAX Lab OAuth Quick Test
======================================

1. Health Check Test
-------------------
âœ… Health check passed

2. Unauthorized Access Test
--------------------------
âœ… Unauthorized access correctly blocked

3. Authenticated Access Test
---------------------------
âœ… Authenticated access successful

4. User Info Test
-----------------
âœ… User info retrieved successfully
Username: testuser

5. Workspace Creation Test
-------------------------
âœ… Workspace created successfully
âœ… Test workspace deleted

6. Performance Test (Simple)
---------------------------
Average response time: 45.2ms
âœ… Performance target met (<200ms)
```

### ì‹¤íŒ¨ ì‹œ ëŒ€ì‘

#### 1. ì„œë²„ ì—°ê²° ì‹¤íŒ¨
```bash
# ì„œë²„ ìƒíƒœ í™•ì¸
curl http://localhost:8010/

# ì„œë²„ ì¬ì‹œì‘
python -m uvicorn app.main:app --host 0.0.0.0 --port 8010
```

#### 2. ì¸ì¦ ì„œë²„ ì—°ê²° ì‹¤íŒ¨
```bash
# ì¸ì¦ ì„œë²„ í™•ì¸
curl http://localhost:8000/

# AUTH_SERVER_URL í™˜ê²½ë³€ìˆ˜ í™•ì¸
echo $AUTH_SERVER_URL
```

#### 3. Redis ì—°ê²° ì‹¤íŒ¨
- Redis ì—†ì´ë„ ë™ì‘í•´ì•¼ í•¨ (fail-open)
- ê²½ê³  ë©”ì‹œì§€ë§Œ í‘œì‹œë˜ê³  ì„œë¹„ìŠ¤ëŠ” ì •ìƒ ë™ì‘

## í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ

í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸:

1. **ì¸ì¦ í”Œë¡œìš°**: OAuth í† í°ìœ¼ë¡œ ì •ìƒ ì¸ì¦ ê°€ëŠ¥
2. **ì˜¤ë¥˜ ì²˜ë¦¬**: êµ¬ì¡°í™”ëœ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜
3. **ì„±ëŠ¥**: í‰ê·  ì‘ë‹µ ì‹œê°„ < 200ms
4. **ì•ˆì •ì„±**: Redis ì—†ì´ë„ ì •ìƒ ë™ì‘
5. **ë³´ì•ˆ**: ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ ì°¨ë‹¨

## ë¬¸ì œ í•´ê²°

### 403 Forbidden ëŒ€ì‹  401 Unauthorized ê¸°ëŒ€
FastAPIì˜ HTTPBearerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 403ì„ ë°˜í™˜í•©ë‹ˆë‹¤. 
ì´ëŠ” ì •ìƒ ë™ì‘ì´ë©°, ë‘ ìƒíƒœ ì½”ë“œ ëª¨ë‘ ì¸ì¦ ì‹¤íŒ¨ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

### êµ¬ì¡°í™”ëœ ì˜¤ë¥˜ ì‘ë‹µì´ ë‚˜ì˜¤ì§€ ì•ŠìŒ
ì¼ë¶€ FastAPI ê¸°ë³¸ ì˜ˆì™¸ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ê±°ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œëŠ” êµ¬ì¡°í™”ëœ ì˜¤ë¥˜ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.

### í† í°ì´ ê±°ë¶€ë¨
1. í† í° ë§Œë£Œ í™•ì¸
2. JWT_SECRET_KEYê°€ ì¸ì¦ ì„œë²„ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
3. í† í° í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸ (Bearer ì ‘ë‘ì‚¬ ë¶ˆí•„ìš”)