
15:37:39.765 🔍 OAuth useEffect triggered:
Object { isAuthenticated: true, authLoading: false, oauthReturn: true, forceLogin: true, oauthProcessedRef: false }
index-C9FwpsSA.js:715:971
15:37:39.766 ✅ User authenticated, checking OAuth return... index-C9FwpsSA.js:715:1270
15:37:39.766 🔄 OAuth return processing: 
Object { isInPopup: true, oauthParams: {…} }
index-C9FwpsSA.js:715:1403
15:37:39.766 {"response_type":"code","client_id":"maxlab","redirect_uri":"https://maxlab.dwchem.co.kr/oauth/callback","scope":"openid profile email offline_access read:profile read:groups manage:workflows","state":"Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4","code_challenge":"XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o","code_challenge_method":"S256","prompt":"login","nonce":"OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M"} index-C9FwpsSA.js:715:1474
15:37:39.767 🚀 User already authenticated in popup, redirecting to OAuth authorize... index-C9FwpsSA.js:715:1619
15:37:39.767 🔄 Popup redirecting to OAuth authorize for code generation (v2 with form.submit): https://max.dwchem.co.kr/api/oauth/authorize?response_type=code&client_id=maxlab&redirect_uri=https%3A%2F%2Fmaxlab.dwchem.co.kr%2Foauth%2Fcallback&scope=openid+profile+email+offline_access+read%3Aprofile+read%3Agroups+manage%3Aworkflows&state=Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4&code_challenge=XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o&code_challenge_method=S256&prompt=login&nonce=OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M index-C9FwpsSA.js:715:1834
15:37:39.768 GET
https://maxlab.dwchem.co.kr/oauth/sync?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyMWEyYWFhNy00NDRhLTQwMzgtYmRhMy1kOGJmMmM0ZWYxNjIiLCJlbWFpbCI6ImFkbWluQHRlc3QuY29tIiwiZXhwIjoxNzU0NjM2ODU5LCJ0eXBlIjoiYWNjZXNzIiwiaWF0IjoxNzU0NjM1MDU5LCJqdGkiOiJiNjYyM2Q1Ni1mZDIyLTQ4M2QtYTIyNy1kZWZjMDU0YjUzM2IiLCJuYmYiOjE3NTQ2MzUwNTksImlzcyI6Im1heHBsYXRmb3JtIiwibm9uY2UiOiJjOTZmZGUwNWVjZjZiNjExIn0.TWCaO6c-nTxh3sYG6lFZ8MW_luI4TKWhgagWCVFtNeU&user={"id":"21a2aaa7-444a-4038-bda3-d8bf2c4ef162","real_name":"관리자","display_name":"admin","email":"admin@test.com","phone_number":"010-1234-5678","department":"관리부","position":"시스템 관리자","is_active":true,"is_admin":true,"is_verified":true,"created_at":"2025-06-19T16:50:56.017084","last_login_at":"2025-08-08T06:37:39.737718","login_count":523,"roles":[],"groups":[]}
NS_BINDING_ABORTED

15:37:39.770 ❌ 인증 초기화 실패: 
Object { message: "Request aborted", name: "AxiosError", code: "ECONNABORTED", config: {…}, request: XMLHttpRequest, stack: "", … }
index-C9FwpsSA.js:539:66633
15:37:39.771 🔍 OAuth useEffect triggered: 
Object { isAuthenticated: true, authLoading: false, oauthReturn: false, forceLogin: true, oauthProcessedRef: true }
index-C9FwpsSA.js:715:971
15:37:39.771 ⏭️ OAuth already processed, skipping... index-C9FwpsSA.js:715:1118
15:37:39.772 🔍 OAuth useEffect triggered: 
Object { isAuthenticated: false, authLoading: false, oauthReturn: false, forceLogin: true, oauthProcessedRef: true }
index-C9FwpsSA.js:715:971
15:37:39.772 ⏭️ OAuth already processed, skipping... index-C9FwpsSA.js:715:1118
15:37:39.772 🔐 AuthContext initAuth 시작: 
Object { hasToken: false }
index-C9FwpsSA.js:539:65836
15:37:39.772 📡 TRY start index-C9FwpsSA.js:539:65898
15:37:39.772 ❌ 토큰이 없어 인증되지 않은 상태 index-C9FwpsSA.js:539:66583
15:37:39.800 GET
https://max.dwchem.co.kr/api/oauth/authorize?response_type=code&client_id=maxlab&redirect_uri=https://maxlab.dwchem.co.kr/oauth/callback&scope=openid+profile+email+offline_access+read:profile+read:groups+manage:workflows&state=Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4&code_challenge=XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o&code_challenge_method=S256&nonce=OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M
NS_BINDING_ABORTED

15:37:39.806 GET
https://max.dwchem.co.kr/api/oauth/authorize?response_type=code&client_id=maxlab&redirect_uri=https://maxlab.dwchem.co.kr/oauth/callback&scope=openid+profile+email+offline_access+read:profile+read:groups+manage:workflows&state=Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4&code_challenge=XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o&code_challenge_method=S256&prompt=login&nonce=OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M
[HTTP/2 307  15ms]

15:37:39.828 GET
https://max.dwchem.co.kr/login?oauth_return={"response_type": "code", "client_id": "maxlab", "redirect_uri": "https://maxlab.dwchem.co.kr/oauth/callback", "scope": "openid profile email offline_access read:profile read:groups manage:workflows", "state": "Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4", "code_challenge": "XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o", "code_challenge_method": "S256", "prompt": "login", "nonce": "OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M"}&force_login=true
[HTTP/2 200  0ms]

15:37:39.841 GET
https://max.dwchem.co.kr/assets/index-DHTf0g6U.css
[HTTP/2 200 OK 0ms]

15:37:39.887 GET
https://max.dwchem.co.kr/assets/index-C9FwpsSA.js
[HTTP/2 200  0ms]

15:37:39.944 🔍 OAuth useEffect triggered: 
Object { isAuthenticated: false, authLoading: true, oauthReturn: true, forceLogin: true, oauthProcessedRef: false }
index-C9FwpsSA.js:715:971
15:37:39.946 🔒 force_login detected - showing login form index-C9FwpsSA.js:715:1190
15:37:39.947 🔐 AuthContext initAuth 시작: 
Object { hasToken: false }
index-C9FwpsSA.js:539:65836
15:37:39.947 📡 TRY start index-C9FwpsSA.js:539:65898
15:37:39.947 ❌ 토큰이 없어 인증되지 않은 상태 index-C9FwpsSA.js:539:66583
15:37:39.949 🔍 OAuth useEffect triggered: 
Object { isAuthenticated: false, authLoading: false, oauthReturn: true, forceLogin: true, oauthProcessedRef: false }
index-C9FwpsSA.js:715:971
15:37:39.949 🔒 force_login detected - showing login form index-C9FwpsSA.js:715:1190
15:37:39.965 GET
https://max.dwchem.co.kr/favicon.ico
[HTTP/2 200  0ms]



0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.520 [INFO] app.routers.auth:382 - 로그인 시도: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.737 [INFO] app.routers.auth:401 - 사용자 인증 성공: admin@test.com (ID: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162)
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.740 [INFO] app.routers.auth:408 - 로그인 기록 업데이트 완료: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.741 [INFO] app.utils.auth:289 - Auth event: access_token_created | Data: {'event_type': 'access_token_created', 'user_id': '21a2aaa7-444a-4038-bda3-d8bf2c4ef162', 'client_id': None, 'success': True, 'additional_data': {'token_type': 'access', 'expires_at': '2025-08-08T07:07:39.741055', 'jti': 'b6623d56-fd22-483d-a227-defc054b533b'}}
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.742 [ERROR] app.services.auth_service:145 - Failed to create Redis session: 'User' object has no attribute 'roles'
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.742 [INFO] app.services.auth_service:63 - ✅ Created Redis session None for user admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.745 [INFO] app.routers.auth:425 - JWT 토큰 생성 및 Redis 세션 동기화 완료: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.746 [WARNING] app.routers.auth:443 - ⚠️ Redis 세션 생성 실패 (JWT만 사용): admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.746 [INFO] app.routers.auth:451 - 로그인 성공: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.746 [INFO] uvicorn.access:496 - 192.168.15.220:0 - "POST /api/auth/login HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.756 [INFO] app.utils.auth:235 - Successfully authenticated user: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.758 [INFO] uvicorn.access:496 - 192.168.15.220:0 - "GET /api/auth/me HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.760 [INFO] app.utils.auth:235 - Successfully authenticated user: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.761 [INFO] uvicorn.access:496 - 192.168.15.220:0 - "GET /api/auth/me HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.811 [DEBUG] app.utils.auth:425 - ✅ User authenticated via JWT token: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.811 [INFO] app.api.oauth_simple:776 - OAuth authorize request: client_id=maxlab, display=None, prompt=login, redirect_uri=https://maxlab.dwchem.co.kr/oauth/callback
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:781 - 🔍 Worker 467216: Current user authentication status: True
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:783 - 🔍 Worker 467216: Authenticated user: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:787 - 🔍 Worker 467216: Request cookies: ['access_token', 'user_id']
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:789 - 🔍 Worker 467216: Access token cookie found: eyJhbGciOiJIUzI1NiIs...
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:795 - 🔍 Worker 467216: Cookie 'access_token': eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyM...
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:795 - 🔍 Worker 467216: Cookie 'user_id': 21a2aaa7-444a-4038-bda3-d8bf2c4ef162...
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:799 - 🔍 Worker 467216: Authorization header: None
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.812 [INFO] app.api.oauth_simple:802 - 🔍 Worker 467216: MAX_PLATFORM_FRONTEND_URL: https://max.dwchem.co.kr
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.813 [INFO] app.api.oauth_simple:875 - 🔄 Worker 467216: Final prompt decision: login
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.813 [DEBUG] app.core.oauth_redis_integration:220 - 🔍 No session ID found in request cookies
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.813 [WARNING] app.api.oauth_simple:913 - ⚠️ Worker 467216: User authenticated but no Redis session found - attempting to create one
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.815 [INFO] app.core.redis_session:92 - ✅ Session created: 787c4a7d-f3d4-4e09-b734-1dbcd0c70486 for user admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.815 [INFO] app.api.oauth_simple:944 - ✅ Worker 467216: Created Redis session 787c4a7d-f3d4-4e09-b734-1dbcd0c70486 for user admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.815 [INFO] app.api.oauth_simple:1090 - prompt=login: forcing re-authentication for client maxlab
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.815 [WARNING] app.api.oauth_simple:1094 - 🔥 Worker 467216: COMPLETE SESSION INVALIDATION for prompt=login - user: admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.816 [DEBUG] app.core.redis_session:127 - 🔍 Session retrieved: 787c4a7d-f3d4-4e09-b734-1dbcd0c70486
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.816 [INFO] app.core.redis_session:199 - ✅ Session deleted: 787c4a7d-f3d4-4e09-b734-1dbcd0c70486
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.816 [INFO] app.core.redis_session:233 - ✅ Deleted 1 sessions for user 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.817 [WARNING] app.api.oauth_simple:1102 - 🔥 Worker 467216: Deleted 1 Redis sessions for user admin@test.com
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.817 [WARNING] app.services.user_switch_security_service:259 - 🔒 SECURITY: Force cleanup initiated - Client: maxlab, Previous User: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162, New User: None
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.818 [INFO] app.services.user_switch_security_service:338 - ✅ User switch cleanup completed - 0 items cleaned
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.818 [INFO] app.api.oauth_simple:1116 - 🔒 Security cleanup for prompt=login: {'success': True, 'cleanup_performed': False, 'stats': {'access_tokens_revoked': 0, 'refresh_tokens_revoked': 0, 'sessions_terminated': 0, 'client_tokens_cleaned': 0, 'errors': []}, 'message': 'Successfully cleaned 0 authentication items'}
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.818 [INFO] app.api.oauth_simple:1147 - Redirecting to login page with force_login=true: https://max.dwchem.co.kr/login?oauth_return=%7B%22response_type%22%3A%20%22code%22%2C%20%22client_id%22%3A%20%22maxlab%22%2C%20%22redirect_uri%22%3A%20%22https%3A//maxlab.dwchem.co.kr/oauth/callback%22%2C%20%22scope%22%3A%20%22openid%20profile%20email%20offline_access%20read%3Aprofile%20read%3Agroups%20manage%3Aworkflows%22%2C%20%22state%22%3A%20%22Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4%22%2C%20%22code_challenge%22%3A%20%22XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o%22%2C%20%22code_challenge_method%22%3A%20%22S256%22%2C%20%22prompt%22%3A%20%22login%22%2C%20%22nonce%22%3A%20%22OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M%22%7D&force_login=true
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.821 [WARNING] app.api.oauth_simple:1164 - 🔥 Worker 467216: Deleting ALL authentication cookies for complete invalidation
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.821 [WARNING] app.api.oauth_simple:1187 - 🔥 Worker 467216: Complete session invalidation completed - redirecting to fresh login
0|maxplatform-backend-8000  | 2025-08-08T15:37:39: 2025-08-08 15:37:39.822 [INFO] uvicorn.access:496 - 192.168.15.220:0 - "GET /api/oauth/authorize?response_type=code&client_id=maxlab&redirect_uri=https%3A%2F%2Fmaxlab.dwchem.co.kr%2Foauth%2Fcallback&scope=openid+profile+email+offline_access+read%3Aprofile+read%3Agroups+manage%3Aworkflows&state=Bdtw1UePEMrS0WFSa5YL8mCI4aCSb2US_7Qzwq8f8S4&code_challenge=XKm5OqLWIuyDi5uf9NFpSTqCHT8zvja_i5is6aFzy_o&code_challenge_method=S256&prompt=login&nonce=OnyN1k0Jk5DaouHvCaHBSv8f2br5L5FcS7Z-HQK3Z-M HTTP/1.1" 307
0|maxplatform-backend-8000  | 2025-08-08T15:38:01: 2025-08-08 15:38:01.590 [DEBUG] app.services.session_monitor:116 - Starting session consistency check
0|maxplatform-backend-8000  | 2025-08-08T15:38:01: 2025-08-08 15:38:01.590 [DEBUG] app.services.session_monitor:177 - Session check completed: 0 sessions checked (took 0.00s)
1|maxplatform-backend-8001  | 2025-08-08T15:38:01: 2025-08-08 15:38:01.731 [DEBUG] app.services.session_monitor:116 - Starting session consistency check
1|maxplatform-backend-8001  | 2025-08-08T15:38:01: 2025-08-08 15:38:01.732 [DEBUG] app.services.session_monitor:177 - Session check completed: 0 sessions checked (took 0.00s)
2|maxplatform-backend-8002  | 2025-08-08T15:38:03: 2025-08-08 15:38:03.129 [DEBUG] app.services.session_monitor:116 - Starting session consistency check
2|maxplatform-backend-8002  | 2025-08-08T15:38:03: 2025-08-08 15:38:03.129 [DEBUG] app.services.session_monitor:177 - Session check completed: 0 sessions checked (took 0.00s)


