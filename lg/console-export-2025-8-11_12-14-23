AuthContext.tsx:64 🔐 AuthContext initAuth 시작: Object
AuthContext.tsx:68 📡 TRY start
AuthContext.tsx:89 📡 사용자 정보 로드 시작
AuthContext.tsx:97 ✅ 사용자 정보 로드 성공: Object
DashboardPage.tsx:98 Features response: Object
DashboardPage.tsx:99 Features data: Array(9)
DashboardPage.tsx:204 Feature clicked: Object
DashboardPage.tsx:205 Feature URL path: https://maxlab.dwchem.co.kr
MainLayout.tsx:54 🔄 Starting smart logout process...
MainLayout.tsx:65 🔄 Calling backend logout API...
MainLayout.tsx:67 ✅ Backend logout API completed
MainLayout.tsx:75 🔄 Performing SSO logout...
AuthContext.tsx:172 🔄 Starting enhanced logout process...
AuthContext.tsx:184 🔄 Executing cross-domain logout synchronization...
crossDomainLogout.ts:35 🔄 Starting cross-domain logout process...
crossDomainLogout.ts:180 ✅ Local storage cleared
crossDomainLogout.ts:219 ✅ Cookies cleared
crossDomainLogout.ts:84 🔄 Attempting MAX Lab logout sync (attempt 1/2)
AuthContext.tsx:64 🔐 AuthContext initAuth 시작: Object
AuthContext.tsx:68 📡 TRY start
AuthContext.tsx:105 ❌ 토큰이 없어 인증되지 않은 상태
LoginPage.jsx:33 🔍 OAuth useEffect triggered: Object
VM1053 index-hqrokkxs.js:228 🔄 Rehydrating auth state for initialization Object
VM1053 index-hqrokkxs.js:228 📋 Authenticated user detected - will validate with server
VM1053 index-hqrokkxs.js:228 📋 Rehydrated state (pending server validation): Object
VM1053 index-hqrokkxs.js:263 🛡️ CSRF protection initialized with existing token
VM1053 index-hqrokkxs.js:263 🔀 OAuth Coordinator [06:54:36][Q:0|A:0]: 🏗️ OAuth Request Coordinator initialized
crossDomainLogout.ts:134 📡 MAX Lab logout sync iframe loaded
VM1053 index-hqrokkxs.js:263 ✅ Auth sync initialized with BroadcastChannel
VM1053 index-hqrokkxs.js:846 🔒 Initializing cross-domain logout listener
VM1053 index-hqrokkxs.js:846 📡 SSO: PostMessage listener registered
VM1053 index-hqrokkxs.js:227 🔄 Auth state change: idle → syncing Object
VM1053 index-hqrokkxs.js:258 🔄 Calling OAuth userinfo endpoint: https://max.dwchem.co.kr/api/oauth/userinfo
VM1053 index-hqrokkxs.js:227 🔄 Auth state change: ready → ready Object
VM1053 index-hqrokkxs.js:49 No routes matched location "/oauth/logout-sync" 
Vs @ VM1053 index-hqrokkxs.js:49
Nv @ VM1053 index-hqrokkxs.js:51
wN @ VM1053 index-hqrokkxs.js:49
IN @ VM1053 index-hqrokkxs.js:51
hh @ VM1053 index-hqrokkxs.js:48
Ah @ VM1053 index-hqrokkxs.js:48
Xy @ VM1053 index-hqrokkxs.js:48
_0 @ VM1053 index-hqrokkxs.js:48
P_ @ VM1053 index-hqrokkxs.js:48
ef @ VM1053 index-hqrokkxs.js:48
x0 @ VM1053 index-hqrokkxs.js:48
z0 @ VM1053 index-hqrokkxs.js:48
Ti @ VM1053 index-hqrokkxs.js:48
D0 @ VM1053 index-hqrokkxs.js:48
(anonymous) @ VM1053 index-hqrokkxs.js:48
crossDomainLogout.ts:93 ⚠️ MAX Lab logout sync timeout
(anonymous) @ crossDomainLogout.ts:93
crossDomainLogout.ts:84 🔄 Attempting MAX Lab logout sync (attempt 2/2)
index-hqrokkxs.js:228 🔄 Rehydrating auth state for initialization {state: {…}}
index-hqrokkxs.js:228 📋 Authenticated user detected - will validate with server
index-hqrokkxs.js:228 📋 Rehydrated state (pending server validation): {user: {…}, isAuthenticated: true, initState: 'syncing', error: null, lastSyncTime: 1754895276683, …}
index-hqrokkxs.js:263 🛡️ CSRF protection initialized with existing token
index-hqrokkxs.js:263 🔀 OAuth Coordinator [06:55:06][Q:0|A:0]: 🏗️ OAuth Request Coordinator initialized
crossDomainLogout.ts:134 📡 MAX Lab logout sync iframe loaded
index-hqrokkxs.js:263 ✅ Auth sync initialized with BroadcastChannel
index-hqrokkxs.js:846 🔒 Initializing cross-domain logout listener
index-hqrokkxs.js:846 📡 SSO: PostMessage listener registered
index-hqrokkxs.js:227 🔄 Auth state change: idle → syncing {isAuthenticated: true, hasUser: true, stackTrace: Array(3)}
index-hqrokkxs.js:258 🔄 Calling OAuth userinfo endpoint: https://max.dwchem.co.kr/api/oauth/userinfo
index-hqrokkxs.js:227 🔄 Auth state change: ready → ready {isAuthenticated: true, hasUser: true, stackTrace: Array(2)}
index-hqrokkxs.js:49 No routes matched location "/oauth/logout-sync" 
Vs @ index-hqrokkxs.js:49
Nv @ index-hqrokkxs.js:51
wN @ index-hqrokkxs.js:49
IN @ index-hqrokkxs.js:51
hh @ index-hqrokkxs.js:48
Ah @ index-hqrokkxs.js:48
Xy @ index-hqrokkxs.js:48
_0 @ index-hqrokkxs.js:48
P_ @ index-hqrokkxs.js:48
ef @ index-hqrokkxs.js:48
x0 @ index-hqrokkxs.js:48
z0 @ index-hqrokkxs.js:48
Ti @ index-hqrokkxs.js:48
D0 @ index-hqrokkxs.js:48
(anonymous) @ index-hqrokkxs.js:48


0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.212 [INFO] app.api.oauth_simple:2832 - 🔐 Starting enhanced logout process - client_id: None
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.212 [INFO] app.api.oauth_simple:2862 - 🔐 Found token in cookie: access_token
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.212 [INFO] app.utils.auth:289 - Auth event: token_verification | Data: {'event_type': 'token_verification', 'user_id': '21a2aaa7-444a-4038-bda3-d8bf2c4ef162', 'client_id': None, 'success': True, 'additional_data': {'token_type': 'access', 'jti': '36c6aa24-b5b4-4001-9dbe-10a361fd228e'}}
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.213 [DEBUG] app.utils.auth:538 - ✅ User validated from token: admin@test.com
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.214 [INFO] app.api.oauth_simple:2866 - 🔐 User from cookie access_token: admin@test.com
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.214 [INFO] app.api.oauth_simple:2923 - 🔐 Revoked direct token: 0 tokens
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.216 [DEBUG] app.core.redis_session:127 - 🔍 Session retrieved: 12c18761-5d86-4237-b2d4-180a918755f8
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.217 [INFO] app.core.redis_session:199 - ✅ Session deleted: 12c18761-5d86-4237-b2d4-180a918755f8
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.217 [INFO] app.core.redis_session:233 - ✅ Deleted 1 sessions for user 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.217 [INFO] app.core.oauth_redis_integration:167 - ✅ Cleaned up 1 OAuth Redis sessions for user 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.217 [INFO] app.api.oauth_simple:3029 - ✅ Cleaned up 1 Redis sessions for user 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.218 [INFO] app.api.oauth_simple:3078 - 🔐 Token revocation completed: {'access_tokens_revoked': 0, 'refresh_tokens_revoked': 1, 'sessions_terminated': 1, 'id_tokens_invalidated': 0, 'cookies_cleared': 0}
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.220 [INFO] app.api.oauth_simple:3118 - 🔐 Logout redirect to trusted domain: max.dwchem.co.kr
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.220 [INFO] app.api.oauth_simple:3130 - 🔐 Enhanced OIDC Logout completed: {'access_tokens_revoked': 0, 'refresh_tokens_revoked': 1, 'sessions_terminated': 1, 'id_tokens_invalidated': 0, 'cookies_cleared': 0}
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.220 [INFO] app.api.oauth_simple:3131 - 🔐 Redirecting to: https://max.dwchem.co.kr/login?logout=success
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.222 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "GET /api/oauth/logout?post_logout_redirect_uri=https%3A%2F%2Fmax.dwchem.co.kr%2Flogin%3Flogout%3Dsuccess HTTP/1.1" 302
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.317 [INFO] app.utils.auth:259 - Successfully authenticated user: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.317 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "GET /api/auth/me HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.344 [INFO] app.utils.auth:259 - Successfully authenticated user: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:54: 2025-08-11 15:49:54.349 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "GET /api/services/mother-page HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-11T15:49:58: 2025-08-11 15:49:58.109 [INFO] app.utils.auth:259 - Successfully authenticated user: 21a2aaa7-444a-4038-bda3-d8bf2c4ef162
0|maxplatform-backend-8000  | 2025-08-11T15:49:58: 2025-08-11 15:49:58.112 [INFO] app.routers.batch_logout:371 - User admin@test.com logged out all sessions
0|maxplatform-backend-8000  | 2025-08-11T15:49:58: 2025-08-11 15:49:58.112 [INFO] app.middleware.security:376 - AUDIT_LOG: {"timestamp": "2025-08-11T06:49:58.112717", "action_type": "user_session_logout", "user_id": "21a2aaa7-444a-4038-bda3-d8bf2c4ef162", "user_email": "admin@test.com", "success": true, "error_message": null, "execution_time": 0.002003, "request_data": {"request": {"logout_type": "all", "reason": "User requested all logout via simplified UI"}}}
0|maxplatform-backend-8000  | 2025-08-11T15:49:58: 2025-08-11 15:49:58.113 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "POST /api/user/sessions/logout HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-11T15:49:58: 2025-08-11 15:49:58.192 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "GET /api/oauth/userinfo HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.210 [INFO] uvicorn.access:496 - 192.168.9.87:0 - "GET /api/oauth/userinfo HTTP/1.1" 200
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.644 [INFO] app.routers.auth:382 - 로그인 시도: krn@test.com
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.858 [INFO] app.routers.auth:401 - 사용자 인증 성공: krn@test.com (ID: d65db892-9691-46e3-a2c6-d962980f2f51)
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.861 [INFO] app.routers.auth:409 - 로그인 기록 업데이트 완료: krn@test.com
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.862 [INFO] app.utils.auth:289 - Auth event: access_token_created | Data: {'event_type': 'access_token_created', 'user_id': 'd65db892-9691-46e3-a2c6-d962980f2f51', 'client_id': None, 'success': True, 'additional_data': {'token_type': 'access', 'expires_at': '2025-08-11T07:20:03.861845', 'jti': 'bfb72ce2-fa6e-4682-abc4-248f2a87b533'}}
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.864 [INFO] app.core.redis_session:233 - ✅ Deleted 0 sessions for user d65db892-9691-46e3-a2c6-
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: 2025-08-11 15:50:03.871 [WARNING] app.routers.auth:483 - Failed to store JWT token hash for revocation tracking: (psycopg2.errors.UndefinedColumn) column "grant_types" of relation "oauth_clients" does not exist
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: LINE 3: ...        (client_id, client_secret, redirect_uris, grant_type...
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                                                              ^
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: [SQL:
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                             INSERT INTO oauth_clients
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                             (client_id, client_secret, redirect_uris, grant_types,
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                              response_types, scope, is_active, is_confidential)
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                             VALUES (%(client_id)s, %(client_secret)s, %(redirect_uris)s, %(grant_types)s,
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                                     %(response_types)s, %(scope)s, true, false)
0|maxplatform-backend-8000  | 2025-08-11T15:50:03:                         ]
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: [parameters: {'client_id': 'maxplatform-web', 'client_secret': 'not-used-f...', 'redirect_uris': 'https://max.dwchem.co.kr,https://maxlab.dwchem.co.kr', 'grant_types': 'password,refresh_token', 'response_types': 'token', 'scope': 'openid profile email'}]
0|maxplatform-backend-8000  | 2025-08-11T15:50:03: (Background on this error at: https://sqlalche.me/e/20/f405)
